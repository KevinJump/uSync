<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

	<ItemGroup>
		<uSyncPackageFolder Include="$(MSBuildProjectDirectory)\App_Plugins\uSync\" />
	</ItemGroup>

	<!-- removing the v9 files, something we can do on build? -->
	<Target Name="CleanuSyncAssets" BeforeTargets="BeforeBuild;Clean"
			Condition="Exists(@(uSyncPackageFolder))">
		<Message Importance="high" Text="Removing legacy uSync9 App_Plugins files" />
		<RemoveDir Directories="@(uSyncPackageFolder)" ContinueOnError="true"></RemoveDir>
	</Target>
	
	<!-- copy the schema file, inject the schema! -->
	<Target Name="CopyuSyncAppSettingsSchema" AfterTargets="CopyAppsettingsSchema">
		<ItemGroup>
			<_uSyncSchemaFiles Include="$(MSBuildThisFileDirectory)..\appsettings-schema.usync.json"></_uSyncSchemaFiles>
		</ItemGroup>
		<Message Text="Copying appsettings-schema.usync.json file"></Message>
		<Copy SourceFiles="@(_uSyncSchemaFiles)" DestinationFolder="$(MSBuildProjectDirectory)" SkipUnchangedFiles="true" />
	</Target>

	<ItemGroup>
		<Content Remove="uSync/**" />
	</ItemGroup>

	<Target Name="PublishuSyncFiles" BeforeTargets="PrepareForPublish">
		<ItemGroup>
			<uSyncFiles Include="uSync/**;" />
		</ItemGroup>
		<Message Text="Copying uSync files: #@(uSyncFiles->Count()) files" Importance="high" />
		<Copy SourceFiles="@(uSyncFiles)" DestinationFolder="$(PublishDir)\uSync\%(RecursiveDir)" SkipUnchangedFiles="true" />
	</Target>


</Project>